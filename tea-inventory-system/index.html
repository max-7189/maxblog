<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>TeaInventory - Beverage Shop Inventory Management System - Ziyuan Zhao</title><meta name=Description content="Hugo theme - LoveIt"><meta property="og:url" content="https://max-7189.github.io/maxblog/tea-inventory-system/">
<meta property="og:site_name" content="Ziyuan Zhao"><meta property="og:title" content="TeaInventory - Beverage Shop Inventory Management System"><meta property="og:description" content="An intelligent inventory management system designed for beverage shops, applying dynamic safety stock theory and machine learning to optimize restocking decisions."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-03T10:00:00+08:00"><meta property="article:modified_time" content="2025-05-06T18:41:37+12:00"><meta property="article:tag" content="IOS"><meta property="article:tag" content="Swift"><meta property="article:tag" content="CoreData"><meta property="article:tag" content="Machine Learning"><meta property="article:tag" content="Inventory Management"><meta property="og:image" content="https://max-7189.github.io/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://max-7189.github.io/logo.png"><meta name=twitter:title content="TeaInventory - Beverage Shop Inventory Management System"><meta name=twitter:description content="An intelligent inventory management system designed for beverage shops, applying dynamic safety stock theory and machine learning to optimize restocking decisions."><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=referrer content="no-referrer"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=https://max-7189.github.io/maxblog/site.webmanifest><link rel=canonical href=https://max-7189.github.io/maxblog/tea-inventory-system/><link rel=prev href=https://max-7189.github.io/maxblog/datamuse-project/><link rel=stylesheet href=/maxblog/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script src=https://max-7189.github.io/maxblog/lib/mermaid/mermaid.min.js></script><script src=https://max-7189.github.io/maxblog/lib/echarts/echarts.min.js></script><script>typeof window.mermaid=="undefined"&&(window.mermaid={initialize:function(){},render:function(){return{svg:""}}})</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"TeaInventory - Beverage Shop Inventory Management System","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/max-7189.github.io\/maxblog\/tea-inventory-system\/"},"image":["https:\/\/max-7189.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"iOS, Swift, CoreData, Machine Learning, Inventory Management","wordcount":2145,"url":"https:\/\/max-7189.github.io\/maxblog\/tea-inventory-system\/","datePublished":"2025-04-03T10:00:00+08:00","dateModified":"2025-05-06T18:41:37+12:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Max Zhao","logo":"https:\/\/max-7189.github.io\/images\/avatar.png"},"author":{"@type":"Person","name":"Max Zhao"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/maxblog/ title="Ziyuan Zhao"><span class=header-title-pre><i class='fas fa-laptop-code fa-fw' aria-hidden=true></i></span>Max Zhao</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/maxblog/posts/>Posts </a><a class=menu-item href=/maxblog/tags/>Tags </a><a class=menu-item href=/maxblog/categories/>Categories </a><a class=menu-item href=/maxblog/categories/documentation/>Docs </a><a class=menu-item href=/maxblog/about/>About </a><a class=menu-item href=https://github.com/max-7189 title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="menu-item language" title="Select Language"><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/maxblog/tea-inventory-system/ selected>English</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/maxblog/ title="Ziyuan Zhao"><span class=header-title-pre><i class='fas fa-laptop-code fa-fw' aria-hidden=true></i></span>Max Zhao</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/maxblog/posts/ title>Posts</a><a class=menu-item href=/maxblog/tags/ title>Tags</a><a class=menu-item href=/maxblog/categories/ title>Categories</a><a class=menu-item href=/maxblog/categories/documentation/ title>Docs</a><a class=menu-item href=/maxblog/about/ title>About</a><a class=menu-item href=https://github.com/max-7189 title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title="Select Language"><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/maxblog/tea-inventory-system/ selected>English</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">TeaInventory - Beverage Shop Inventory Management System</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/maxblog/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Max Zhao</a></span>&nbsp;<span class=post-category>included in <a href=/maxblog/categories/projects/><i class="far fa-folder fa-fw" aria-hidden=true></i>Projects</a>&nbsp;<a href=/maxblog/categories/mobile-development/><i class="far fa-folder fa-fw" aria-hidden=true></i>Mobile Development</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2025-04-03>2025-04-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;2145 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;11 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-project-overview>1. Project Overview</a></li><li><a href=#2-technical-architecture>2. Technical Architecture</a><ul><li><a href=#21-development-environment>2.1 Development Environment</a></li><li><a href=#22-architecture-design>2.2 Architecture Design</a></li></ul></li><li><a href=#3-core-data-models>3. Core Data Models</a></li><li><a href=#4-core-functional-modules>4. Core Functional Modules</a><ul><li><a href=#41-ingredient-management-ingredientview>4.1 Ingredient Management (IngredientView)</a></li><li><a href=#42-product-management-productview>4.2 Product Management (ProductView)</a></li><li><a href=#43-inventory-count-inventorycountview>4.3 Inventory Count (InventoryCountView)</a></li><li><a href=#44-restock-management-restockrecordview>4.4 Restock Management (RestockRecordView)</a></li><li><a href=#45-data-analysis-analyticsview>4.5 Data Analysis (AnalyticsView)</a></li><li><a href=#46-settings-management-settingsview>4.6 Settings Management (SettingsView)</a></li></ul></li><li><a href=#5-intelligent-prediction-system>5. Intelligent Prediction System</a><ul><li><a href=#51-basic-prediction-model-dynamic-safety-stock-calculation>5.1 Basic Prediction Model: Dynamic Safety Stock Calculation</a><ul><li><a href=#511-mathematical-principles>5.1.1 Mathematical Principles</a></li><li><a href=#512-service-level-and-z-score-relationship>5.1.2 Service Level and Z-Score Relationship</a></li><li><a href=#513-exponential-smoothing>5.1.3 Exponential Smoothing</a></li></ul></li><li><a href=#514-code-implementation>5.1.4 Code Implementation</a></li><li><a href=#515-reorder-point-and-restock-quantity-calculation>5.1.5 Reorder Point and Restock Quantity Calculation</a></li><li><a href=#52-regression-analysis-model-ingredient-consumption-prediction>5.2 Regression Analysis Model: Ingredient Consumption Prediction</a><ul><li><a href=#521-mathematical-principles>5.2.1 Mathematical Principles</a></li><li><a href=#522-hybrid-prediction-system>5.2.2 Hybrid Prediction System</a></li><li><a href=#523-gradient-descent-training>5.2.3 Gradient Descent Training</a></li><li><a href=#524-feature-normalization>5.2.4 Feature Normalization</a></li><li><a href=#525-hybrid-prediction-implementation>5.2.5 Hybrid Prediction Implementation</a></li><li><a href=#526-model-maturity-calculation>5.2.6 Model Maturity Calculation</a></li><li><a href=#527-regression-model-workflow>5.2.7 Regression Model Workflow</a></li><li><a href=#528-model-performance-visualization>5.2.8 Model Performance Visualization</a><ul><li><a href=#r-values-vs-sample-size>R² Values vs Sample Size</a></li><li><a href=#actual-vs-predicted-values>Actual vs Predicted Values</a></li><li><a href=#prediction-error-analysis>Prediction Error Analysis</a></li><li><a href=#feature-importance-analysis>Feature Importance Analysis</a></li><li><a href=#correlation-matrix-analysis>Correlation Matrix Analysis</a></li></ul></li></ul></li><li><a href=#53-model-integration-and-adaptive-mechanisms>5.3 Model Integration and Adaptive Mechanisms</a></li></ul></li><li><a href=#6-technical-highlights>6. Technical Highlights</a><ul><li><a href=#61-optimized-coredata-usage>6.1 Optimized CoreData Usage</a></li><li><a href=#62-advanced-swiftui-features>6.2 Advanced SwiftUI Features</a></li><li><a href=#63-advanced-error-prevention-mechanisms>6.3 Advanced Error Prevention Mechanisms</a></li><li><a href=#64-data-analysis-and-visualization>6.4 Data Analysis and Visualization</a></li><li><a href=#65-google-sheets-integration>6.5 Google Sheets Integration</a></li></ul></li><li><a href=#7-security-features>7. Security Features</a></li><li><a href=#8-extensibility-design>8. Extensibility Design</a></li><li><a href=#9-future-development-directions>9. Future Development Directions</a></li></ul></nav></div></div><div class=content id=content><h1 id=teainventory-beverage-shop-inventory-management-system---technical-documentation>TeaInventory: Beverage Shop Inventory Management System - Technical Documentation</h1><h2 id=1-project-overview>1. Project Overview</h2><p>TeaInventory is an iOS inventory management system specifically designed for beverage shops, developed using SwiftUI and CoreData. It addresses key challenges in inventory management, ingredient consumption prediction, and intelligent restocking for tea shops. The project implements the MVVM architecture combined with machine learning technology to achieve intelligent inventory management.</p><h2 id=2-technical-architecture>2. Technical Architecture</h2><h3 id=21-development-environment>2.1 Development Environment</h3><ul><li>Language: Swift 5.9+</li><li>UI Framework: SwiftUI</li><li>Data Persistence: CoreData</li><li>Charts: SwiftUI Charts</li><li>Minimum iOS Version: iOS 16.0</li></ul><h3 id=22-architecture-design>2.2 Architecture Design</h3><p>The project uses the MVVM (Model-View-ViewModel) architecture:</p><ul><li><strong>Model</strong>: CoreData entities and business logic classes</li><li><strong>View</strong>: SwiftUI view layer</li><li><strong>ViewModel</strong>: Logic controllers, such as InventoryManager</li></ul><h2 id=3-core-data-models>3. Core Data Models</h2><p>The project uses CoreData to design the following main entities:</p><ul><li><strong>Ingredient</strong>: Contains attributes like name, category, currentStock, initialStock, price, leadTime, etc.</li><li><strong>Product</strong>: Contains name, price, isActive attributes and associations with RecipeItem and SalesRecord</li><li><strong>RecipeItem</strong>: Intermediate entity connecting Product and Ingredient</li><li><strong>SalesRecord</strong>: Records product sales data</li><li><strong>RestockRecord</strong>: Records ingredient restocking history</li><li><strong>InventoryCount</strong>: Records inventory counting data</li></ul><h2 id=4-core-functional-modules>4. Core Functional Modules</h2><h3 id=41-ingredient-management-ingredientview>4.1 Ingredient Management (IngredientView)</h3><ul><li>Ingredient CRUD operations</li><li>Category management and filtering</li><li>Detailed information display and editing</li><li>Inventory status visualization (red-yellow-green indicators)</li><li>Ingredient deletion functionality (with cascading deletion of related records)</li></ul><h3 id=42-product-management-productview>4.2 Product Management (ProductView)</h3><ul><li>Product CRUD operations</li><li>Recipe editing</li><li>Sales records</li><li>Product detail view</li><li>Product deletion functionality (clearing related recipes and sales records)</li></ul><h3 id=43-inventory-count-inventorycountview>4.3 Inventory Count (InventoryCountView)</h3><ul><li>Real-time inventory counting</li><li>Count history records</li><li>Calculation of actual consumption based on count differences</li><li>Batch counting functionality (renamed to &ldquo;Inventory Adjustment&rdquo;)</li></ul><h3 id=44-restock-management-restockrecordview>4.4 Restock Management (RestockRecordView)</h3><ul><li>Intelligent restocking suggestions</li><li>Restock record management</li><li>One-click restocking functionality</li><li>Restock quantity calculation based on dynamic safety stock</li></ul><h3 id=45-data-analysis-analyticsview>4.5 Data Analysis (AnalyticsView)</h3><ul><li>Sales trend analysis</li><li>Ingredient consumption analysis</li><li>Chart visualization</li></ul><h3 id=46-settings-management-settingsview>4.6 Settings Management (SettingsView)</h3><ul><li>Feature toggle controls</li><li>Prediction model parameter adjustments</li><li>Regression model parameter adjustments</li><li>Data import/export</li><li>System reset functionality</li></ul><h2 id=5-intelligent-prediction-system>5. Intelligent Prediction System</h2><h3 id=51-basic-prediction-model-dynamic-safety-stock-calculation>5.1 Basic Prediction Model: Dynamic Safety Stock Calculation</h3><h4 id=511-mathematical-principles>5.1.1 Mathematical Principles</h4><p>The basic prediction model is primarily based on <strong>dynamic safety stock theory</strong>, using exponential smoothing and service level concepts to optimize inventory management.</p><p>The core formula for safety stock calculation is:</p><p>$$SS = z \cdot \sigma_L \cdot \sqrt{L}$$</p><p>Where:</p><ul><li>$SS$ is the safety stock level</li><li>$z$ is the Z-score corresponding to the service level in standard normal distribution</li><li>$\sigma_L$ is the standard deviation of demand</li><li>$L$ is the lead time for restocking</li></ul><p>In the system implementation, it is expressed as:</p><p>$$SS = \overline{D} \cdot L + z \cdot \sigma_D \cdot \sqrt{L}$$</p><p>Where:</p><ul><li>$\overline{D}$ is the daily average consumption</li><li>$\sigma_D$ is the standard deviation of consumption</li></ul><h4 id=512-service-level-and-z-score-relationship>5.1.2 Service Level and Z-Score Relationship</h4><p>Service levels and Z-scores are related through the standard normal distribution function:</p><table><thead><tr><th>Service Level</th><th>Z-Score</th></tr></thead><tbody><tr><td>90%</td><td>1.28</td></tr><tr><td>95%</td><td>1.65</td></tr><tr><td>98%</td><td>2.33</td></tr><tr><td>99%</td><td>2.58</td></tr></tbody></table><h4 id=513-exponential-smoothing>5.1.3 Exponential Smoothing</h4><p>Exponential smoothing is used to predict future consumption, calculated as:</p><p>$$F_t = \alpha \cdot D_{t-1} + (1-\alpha) \cdot F_{t-1}$$</p><p>Where:</p><ul><li>$F_t$ is the forecast for time t</li><li>$D_{t-1}$ is the actual consumption at time t-1</li><li>$F_{t-1}$ is the forecast for time t-1</li><li>$\alpha$ is the smoothing coefficient (0.1-0.5)</li></ul><h3 id=514-code-implementation>5.1.4 Code Implementation</h3><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-swift"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>func</span> <span class=nf>calculateDynamicSafetyStock</span><span class=p>(</span><span class=n>ingredient</span><span class=p>:</span> <span class=n>Ingredient</span><span class=p>,</span> <span class=n>alpha</span><span class=p>:</span> <span class=nb>Double</span><span class=p>?</span> <span class=p>=</span> <span class=kc>nil</span><span class=p>,</span> <span class=n>serviceLevel</span><span class=p>:</span> <span class=nb>Double</span><span class=p>?</span> <span class=p>=</span> <span class=kc>nil</span><span class=p>)</span> <span class=p>-&gt;</span> <span class=nb>Double</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// If prediction feature is turned off, return a percentage of initial stock as safety stock</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>!</span><span class=n>enablePrediction</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>ingredient</span><span class=p>.</span><span class=n>initialStock</span> <span class=o>*</span> <span class=mf>0.2</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>serviceLevelValue</span> <span class=p>=</span> <span class=n>serviceLevel</span> <span class=p>??</span> <span class=kc>self</span><span class=p>.</span><span class=n>serviceLevel</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>dailyConsumptionAverage</span> <span class=p>=</span> <span class=n>calculateDailyConsumptionAverage</span><span class=p>(</span><span class=n>ingredient</span><span class=p>:</span> <span class=n>ingredient</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>standardDeviation</span> <span class=p>=</span> <span class=n>calculateConsumptionStandardDeviation</span><span class=p>(</span><span class=n>ingredient</span><span class=p>:</span> <span class=n>ingredient</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>leadTime</span> <span class=p>=</span> <span class=nb>Double</span><span class=p>(</span><span class=n>ingredient</span><span class=p>.</span><span class=n>leadTime</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Service level coefficient (Z)</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>zScore</span> <span class=p>=</span> <span class=n>calculateZScore</span><span class=p>(</span><span class=n>serviceLevel</span><span class=p>:</span> <span class=n>serviceLevelValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>dailyConsumptionAverage</span> <span class=o>*</span> <span class=n>leadTime</span> <span class=o>+</span> <span class=n>zScore</span> <span class=o>*</span> <span class=n>standardDeviation</span> <span class=o>*</span> <span class=n>sqrt</span><span class=p>(</span><span class=n>leadTime</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Z-score calculation</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>func</span> <span class=nf>calculateZScore</span><span class=p>(</span><span class=n>serviceLevel</span><span class=p>:</span> <span class=nb>Double</span><span class=p>)</span> <span class=p>-&gt;</span> <span class=nb>Double</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=n>serviceLevel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mf>0.90</span><span class=p>...</span><span class=mf>0.91</span><span class=p>:</span> <span class=k>return</span> <span class=mf>1.28</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mf>0.92</span><span class=p>...</span><span class=mf>0.93</span><span class=p>:</span> <span class=k>return</span> <span class=mf>1.41</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mf>0.94</span><span class=p>...</span><span class=mf>0.95</span><span class=p>:</span> <span class=k>return</span> <span class=mf>1.65</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mf>0.96</span><span class=p>...</span><span class=mf>0.97</span><span class=p>:</span> <span class=k>return</span> <span class=mf>1.88</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mf>0.98</span><span class=p>...</span><span class=mf>0.99</span><span class=p>:</span> <span class=k>return</span> <span class=mf>2.33</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mf>0.9985</span><span class=p>...</span><span class=mf>0.9999</span><span class=p>:</span> <span class=k>return</span> <span class=mf>3.0</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=p>:</span> <span class=k>return</span> <span class=mf>1.65</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Standard deviation calculation</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>func</span> <span class=nf>calculateStandardDeviation</span><span class=p>(</span><span class=n>values</span><span class=p>:</span> <span class=p>[</span><span class=nb>Double</span><span class=p>])</span> <span class=p>-&gt;</span> <span class=nb>Double</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>guard</span> <span class=o>!</span><span class=n>values</span><span class=p>.</span><span class=bp>isEmpty</span> <span class=k>else</span> <span class=p>{</span> <span class=k>return</span> <span class=mf>0.0</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>count</span> <span class=p>=</span> <span class=nb>Double</span><span class=p>(</span><span class=n>values</span><span class=p>.</span><span class=bp>count</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>mean</span> <span class=p>=</span> <span class=n>values</span><span class=p>.</span><span class=bp>reduce</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=o>+</span><span class=p>)</span> <span class=o>/</span> <span class=bp>count</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>sumOfSquaredDifferences</span> <span class=p>=</span> <span class=n>values</span><span class=p>.</span><span class=bp>map</span> <span class=p>{</span> <span class=n>pow</span><span class=p>(</span><span class=nv>$0</span> <span class=o>-</span> <span class=n>mean</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span> <span class=p>}.</span><span class=bp>reduce</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=o>+</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>sqrt</span><span class=p>(</span><span class=n>sumOfSquaredDifferences</span> <span class=o>/</span> <span class=bp>count</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h3 id=515-reorder-point-and-restock-quantity-calculation>5.1.5 Reorder Point and Restock Quantity Calculation</h3><p>The system determines whether restocking is needed based on current inventory and safety stock:</p><p>$$RestockQuantity = (DailyConsumptionAverage \times LeadTime + SafetyStock) - CurrentStock$$</p><p>This is implemented in code as:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-swift"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>func</span> <span class=nf>calculateSuggestedRestockAmount</span><span class=p>(</span><span class=n>ingredient</span><span class=p>:</span> <span class=n>Ingredient</span><span class=p>)</span> <span class=p>-&gt;</span> <span class=nb>Double</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>remainingStock</span> <span class=p>=</span> <span class=n>calculateRemainingStock</span><span class=p>(</span><span class=n>ingredient</span><span class=p>:</span> <span class=n>ingredient</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>enablePrediction</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nv>dailyConsumptionAverage</span> <span class=p>=</span> <span class=n>calculateDailyConsumptionAverage</span><span class=p>(</span><span class=n>ingredient</span><span class=p>:</span> <span class=n>ingredient</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nv>leadTime</span> <span class=p>=</span> <span class=nb>Double</span><span class=p>(</span><span class=n>ingredient</span><span class=p>.</span><span class=n>leadTime</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Calculate expected consumption during lead time</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nv>expectedConsumptionDuringLeadTime</span> <span class=p>=</span> <span class=n>dailyConsumptionAverage</span> <span class=o>*</span> <span class=n>leadTime</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Calculate safety stock</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nv>safetyStock</span> <span class=p>=</span> <span class=n>calculateDynamicSafetyStock</span><span class=p>(</span><span class=n>ingredient</span><span class=p>:</span> <span class=n>ingredient</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Suggested restock amount = Expected consumption during lead time + Safety stock - Current stock</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nv>suggestedAmount</span> <span class=p>=</span> <span class=n>expectedConsumptionDuringLeadTime</span> <span class=o>+</span> <span class=n>safetyStock</span> <span class=o>-</span> <span class=n>remainingStock</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>suggestedAmount</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>ingredient</span><span class=p>.</span><span class=n>initialStock</span> <span class=o>-</span> <span class=n>remainingStock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h3 id=52-regression-analysis-model-ingredient-consumption-prediction>5.2 Regression Analysis Model: Ingredient Consumption Prediction</h3><h4 id=521-mathematical-principles>5.2.1 Mathematical Principles</h4><p>The regression analysis model uses <strong>multivariate linear regression</strong> techniques to establish the relationship between product sales and ingredient consumption. The core is solving the matrix equation:</p><p>$$\mathbf{y} = \mathbf{X}\mathbf{\beta} + \mathbf{\epsilon}$$</p><p>Where:</p><ul><li>$\mathbf{y}$ is the ingredient consumption vector</li><li>$\mathbf{X}$ is the product sales matrix</li><li>$\mathbf{\beta}$ is the regression coefficient vector (to be determined)</li><li>$\mathbf{\epsilon}$ is the error term</li></ul><p>The system implements linear regression with L2 regularization (Ridge regression), with the objective function:</p><p>$$J(\mathbf{\beta}) = \frac{1}{2m}\sum_{i=1}^{m}(h_{\mathbf{\beta}}(\mathbf{x}^{(i)}) - y^{(i)})^2 + \frac{\lambda}{2m}\sum_{j=1}^{n}\beta_j^2$$</p><p>Where:</p><ul><li>$m$ is the number of samples</li><li>$n$ is the number of features (product types)</li><li>$\lambda$ is the regularization parameter</li><li>$h_{\mathbf{\beta}}(\mathbf{x}^{(i)})$ is the prediction function, equal to $\mathbf{x}^{(i)} \cdot \mathbf{\beta}$</li></ul><h4 id=522-hybrid-prediction-system>5.2.2 Hybrid Prediction System</h4><p>The final prediction uses a hybrid system, combining recipe calculation and regression prediction:</p><p>$$Consumption = \alpha \times RecipeCalculatedValue + (1-\alpha) \times RegressionPredictedValue$$</p><p>Where $\alpha$ is adjusted with model maturity:</p><p>$$\alpha = 1 - ModelMaturity$$</p><h4 id=523-gradient-descent-training>5.2.3 Gradient Descent Training</h4><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-swift"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=c1>// Train model using gradient descent algorithm</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>func</span> <span class=nf>trainWithGradientDescent</span><span class=p>(</span><span class=n>X</span><span class=p>:</span> <span class=p>[[</span><span class=nb>Double</span><span class=p>]],</span> <span class=n>y</span><span class=p>:</span> <span class=p>[</span><span class=nb>Double</span><span class=p>],</span> <span class=n>iterations</span><span class=p>:</span> <span class=nb>Int</span> <span class=p>=</span> <span class=mi>1000</span><span class=p>,</span> <span class=n>learningRate</span><span class=p>:</span> <span class=nb>Double</span> <span class=p>=</span> <span class=mf>0.01</span><span class=p>,</span> <span class=n>l2Regularization</span><span class=p>:</span> <span class=nb>Double</span> <span class=p>=</span> <span class=mf>0.1</span><span class=p>)</span> <span class=p>-&gt;</span> <span class=p>[</span><span class=nb>Double</span><span class=p>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>m</span> <span class=p>=</span> <span class=nb>Double</span><span class=p>(</span><span class=n>X</span><span class=p>.</span><span class=bp>count</span><span class=p>)</span>  <span class=c1>// Number of samples</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>n</span> <span class=p>=</span> <span class=n>X</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=bp>count</span>       <span class=c1>// Number of features</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Initialize parameters</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nv>theta</span> <span class=p>=</span> <span class=nb>Array</span><span class=p>(</span><span class=n>repeating</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Execute gradient descent</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=kc>_</span> <span class=k>in</span> <span class=mf>0.</span><span class=p>.&lt;</span><span class=n>iterations</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Calculate predictions</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nv>predictions</span> <span class=p>=</span> <span class=n>X</span><span class=p>.</span><span class=bp>map</span> <span class=p>{</span> <span class=n>row</span> <span class=k>in</span>
</span></span><span class=line><span class=cl>            <span class=n>dotProduct</span><span class=p>(</span><span class=n>row</span><span class=p>,</span> <span class=n>theta</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Calculate errors</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nv>errors</span> <span class=p>=</span> <span class=n>zip</span><span class=p>(</span><span class=n>predictions</span><span class=p>,</span> <span class=n>y</span><span class=p>).</span><span class=bp>map</span> <span class=p>{</span> <span class=nv>$0</span> <span class=o>-</span> <span class=nv>$1</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Update parameters (with L2 regularization)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=k>in</span> <span class=mf>0.</span><span class=p>.&lt;</span><span class=n>n</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=nv>gradient</span> <span class=p>=</span> <span class=p>(</span><span class=mf>1.0</span><span class=o>/</span><span class=n>m</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>zip</span><span class=p>(</span><span class=n>errors</span><span class=p>,</span> <span class=n>X</span><span class=p>).</span><span class=bp>map</span> <span class=p>{</span> <span class=n>error</span><span class=p>,</span> <span class=n>row</span> <span class=k>in</span>
</span></span><span class=line><span class=cl>                    <span class=n>error</span> <span class=o>*</span> <span class=n>row</span><span class=p>[</span><span class=n>j</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=p>}.</span><span class=bp>reduce</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>+</span><span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>                <span class=n>l2Regularization</span> <span class=o>*</span> <span class=n>theta</span><span class=p>[</span><span class=n>j</span><span class=p>]</span>  <span class=c1>// L2 regularization term</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>theta</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=p>=</span> <span class=n>theta</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>-</span> <span class=n>learningRate</span> <span class=o>*</span> <span class=n>gradient</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>theta</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Calculate dot product</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>func</span> <span class=nf>dotProduct</span><span class=p>(</span><span class=kc>_</span> <span class=n>row</span><span class=p>:</span> <span class=p>[</span><span class=nb>Double</span><span class=p>],</span> <span class=kc>_</span> <span class=n>theta</span><span class=p>:</span> <span class=p>[</span><span class=nb>Double</span><span class=p>])</span> <span class=p>-&gt;</span> <span class=nb>Double</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>zip</span><span class=p>(</span><span class=n>row</span><span class=p>,</span> <span class=n>theta</span><span class=p>).</span><span class=bp>reduce</span><span class=p>(</span><span class=mf>0.0</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$0</span> <span class=o>+</span> <span class=nv>$1</span><span class=p>.</span><span class=mi>0</span> <span class=o>*</span> <span class=nv>$1</span><span class=p>.</span><span class=mi>1</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h4 id=524-feature-normalization>5.2.4 Feature Normalization</h4><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-swift"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=c1>// Normalize features</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>func</span> <span class=nf>normalizeFeatures</span><span class=p>(</span><span class=n>X</span><span class=p>:</span> <span class=p>[[</span><span class=nb>Double</span><span class=p>]])</span> <span class=p>-&gt;</span> <span class=p>([[</span><span class=nb>Double</span><span class=p>]],</span> <span class=p>[</span><span class=nb>Double</span><span class=p>],</span> <span class=p>[</span><span class=nb>Double</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>n</span> <span class=p>=</span> <span class=n>X</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=bp>count</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nv>means</span> <span class=p>=</span> <span class=nb>Array</span><span class=p>(</span><span class=n>repeating</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span> <span class=bp>count</span><span class=p>:</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nv>stdDevs</span> <span class=p>=</span> <span class=nb>Array</span><span class=p>(</span><span class=n>repeating</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span> <span class=bp>count</span><span class=p>:</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Calculate mean for each column</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=k>in</span> <span class=mf>0.</span><span class=p>.&lt;</span><span class=n>n</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nv>column</span> <span class=p>=</span> <span class=n>X</span><span class=p>.</span><span class=bp>map</span> <span class=p>{</span> <span class=nv>$0</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>means</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=p>=</span> <span class=n>column</span><span class=p>.</span><span class=bp>reduce</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=o>+</span><span class=p>)</span> <span class=o>/</span> <span class=nb>Double</span><span class=p>(</span><span class=n>column</span><span class=p>.</span><span class=bp>count</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Calculate standard deviation for each column</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=k>in</span> <span class=mf>0.</span><span class=p>.&lt;</span><span class=n>n</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nv>column</span> <span class=p>=</span> <span class=n>X</span><span class=p>.</span><span class=bp>map</span> <span class=p>{</span> <span class=nv>$0</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nv>squaredDiffs</span> <span class=p>=</span> <span class=n>column</span><span class=p>.</span><span class=bp>map</span> <span class=p>{</span> <span class=n>pow</span><span class=p>(</span><span class=nv>$0</span> <span class=o>-</span> <span class=n>means</span><span class=p>[</span><span class=n>j</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>stdDevs</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=p>=</span> <span class=n>sqrt</span><span class=p>(</span><span class=n>squaredDiffs</span><span class=p>.</span><span class=bp>reduce</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=o>+</span><span class=p>)</span> <span class=o>/</span> <span class=nb>Double</span><span class=p>(</span><span class=n>column</span><span class=p>.</span><span class=bp>count</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Prevent division by zero</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>stdDevs</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=p>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>stdDevs</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=p>=</span> <span class=mf>1.0</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Normalize data</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>normalizedX</span> <span class=p>=</span> <span class=n>X</span><span class=p>.</span><span class=bp>map</span> <span class=p>{</span> <span class=n>row</span> <span class=k>in</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=mf>0.</span><span class=p>.&lt;</span><span class=n>n</span><span class=p>).</span><span class=bp>map</span> <span class=p>{</span> <span class=n>j</span> <span class=k>in</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=n>row</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>-</span> <span class=n>means</span><span class=p>[</span><span class=n>j</span><span class=p>])</span> <span class=o>/</span> <span class=n>stdDevs</span><span class=p>[</span><span class=n>j</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>normalizedX</span><span class=p>,</span> <span class=n>means</span><span class=p>,</span> <span class=n>stdDevs</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h4 id=525-hybrid-prediction-implementation>5.2.5 Hybrid Prediction Implementation</h4><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-swift"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=c1>// Predict consumption</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>predictConsumption</span><span class=p>(</span><span class=n>ingredientID</span><span class=p>:</span> <span class=nb>String</span><span class=p>,</span> <span class=n>sales</span><span class=p>:</span> <span class=p>[</span><span class=nb>String</span><span class=p>:</span> <span class=nb>Double</span><span class=p>],</span> <span class=n>recipeBasedConsumption</span><span class=p>:</span> <span class=nb>Double</span><span class=p>)</span> <span class=p>-&gt;</span> <span class=nb>Double</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Get hybrid coefficient</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>alpha</span> <span class=p>=</span> <span class=n>RegressionModelStore</span><span class=p>.</span><span class=n>shared</span><span class=p>.</span><span class=n>getModelAlpha</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Recipe-based calculation</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>recipeAmount</span> <span class=p>=</span> <span class=n>recipeBasedConsumption</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// If no trained model or empty sales data, return recipe-based calculation</span>
</span></span><span class=line><span class=cl>    <span class=k>guard</span> <span class=kd>let</span> <span class=nv>model</span> <span class=p>=</span> <span class=n>models</span><span class=p>[</span><span class=n>ingredientID</span><span class=p>],</span> <span class=o>!</span><span class=n>sales</span><span class=p>.</span><span class=bp>isEmpty</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>recipeAmount</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Prepare feature vector</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nv>features</span><span class=p>:</span> <span class=p>[</span><span class=nb>Double</span><span class=p>]</span> <span class=p>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>productID</span> <span class=k>in</span> <span class=n>model</span><span class=p>.</span><span class=n>productIDs</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>features</span><span class=p>.</span><span class=n>append</span><span class=p>(</span><span class=n>sales</span><span class=p>[</span><span class=n>productID</span><span class=p>]</span> <span class=p>??</span> <span class=mf>0.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Feature normalization</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>normalizedFeatures</span> <span class=p>=</span> <span class=n>features</span><span class=p>.</span><span class=n>enumerated</span><span class=p>().</span><span class=bp>map</span> <span class=p>{</span> <span class=n>j</span><span class=p>,</span> <span class=n>value</span> <span class=k>in</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>value</span> <span class=o>-</span> <span class=n>model</span><span class=p>.</span><span class=n>means</span><span class=p>[</span><span class=n>j</span><span class=p>])</span> <span class=o>/</span> <span class=n>model</span><span class=p>.</span><span class=n>stdDevs</span><span class=p>[</span><span class=n>j</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Calculate prediction</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>prediction</span> <span class=p>=</span> <span class=n>dotProduct</span><span class=p>(</span><span class=n>normalizedFeatures</span><span class=p>,</span> <span class=n>model</span><span class=p>.</span><span class=n>coefficients</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Use hybrid model</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>alpha</span> <span class=o>*</span> <span class=n>recipeAmount</span> <span class=o>+</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>alpha</span><span class=p>)</span> <span class=o>*</span> <span class=n>prediction</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h4 id=526-model-maturity-calculation>5.2.6 Model Maturity Calculation</h4><p>Model maturity is calculated based on the number of training samples collected and prediction accuracy:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-swift"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>func</span> <span class=nf>getRegressionModelMaturity</span><span class=p>()</span> <span class=p>-&gt;</span> <span class=nb>Double</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Sample ratio, maximum 1.0</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>sampleRatio</span> <span class=p>=</span> <span class=bp>min</span><span class=p>(</span><span class=nb>Double</span><span class=p>(</span><span class=n>collectedDataPoints</span><span class=p>)</span> <span class=o>/</span> <span class=nb>Double</span><span class=p>(</span><span class=n>requiredDataPointsForMaturity</span><span class=p>),</span> <span class=mf>1.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// MSE change ratio, maximum 1.0</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>mseRatio</span> <span class=p>=</span> <span class=n>baselineMSE</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=p>?</span> <span class=bp>min</span><span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=p>(</span><span class=n>currentMSE</span> <span class=o>/</span> <span class=n>baselineMSE</span><span class=p>),</span> <span class=mf>1.0</span><span class=p>)</span> <span class=p>:</span> <span class=mf>0.0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Combined score, sample size has 70% weight, error improvement has 30% weight</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>maturity</span> <span class=p>=</span> <span class=mf>0.7</span> <span class=o>*</span> <span class=n>sampleRatio</span> <span class=o>+</span> <span class=mf>0.3</span> <span class=o>*</span> <span class=n>mseRatio</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=bp>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=bp>min</span><span class=p>(</span><span class=n>maturity</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h4 id=527-regression-model-workflow>5.2.7 Regression Model Workflow</h4><p>The following diagram illustrates the basic workflow of the regression model in the TeaInventory system:</p><div class=mermaid id=id-1><script type=text/template class=mermaid-source-data>flowchart TD
    A[Data Collection] --&gt; B[Data Preprocessing]
    B --&gt; C[Feature Engineering]
    C --&gt; D[Model Training]
    D --&gt; E[Model Evaluation]
    E -- Poor Performance --&gt; C
    E -- Good Performance --&gt; F[Model Deployment]
    F --&gt; G[Consumption Prediction]
    G --&gt; H[Hybrid with Recipe Calculation]
    H --&gt; I[Generate Restock Suggestions]
    J[New Sales Data] --&gt; K[Model Update]
    K --&gt; F
    
    style D fill:#f96,stroke:#333,stroke-width:2px
    style G fill:#bbf,stroke:#333,stroke-width:2px
    style H fill:#bbf,stroke:#333,stroke-width:2px</script></div><p>The model workflow includes data collection, feature engineering, model training and evaluation, model deployment, and continuous updates. During the prediction phase, the system combines regression predictions with recipe calculations to generate the final consumption forecasts, providing accurate restock suggestions.</p><h4 id=528-model-performance-visualization>5.2.8 Model Performance Visualization</h4><p>Through visualization of the regression model&rsquo;s test data, we can gain a more intuitive understanding of the model&rsquo;s performance.</p><h5 id=r-values-vs-sample-size>R² Values vs Sample Size</h5><p>As the number of data points collected increases, the performance of the regression model improves. The following chart shows how R² values change with increasing sample size for different ingredients:</p><div class=echarts id=id-2 style=width:100%;height:30rem></div><p>With a sample size of approximately 40-50 data points, most ingredients&rsquo; R² values stabilize above 0.9, indicating that the model has achieved good predictive performance.</p><h5 id=actual-vs-predicted-values>Actual vs Predicted Values</h5><p>The following chart compares the actual consumption amounts with regression model predictions and recipe-based calculations for a typical ingredient:</p><div class=echarts id=id-3 style=width:100%;height:30rem></div><p>From the chart, it&rsquo;s evident that as the model learns, regression predictions increasingly approach actual consumption values, and in some cases perform better than recipe calculations alone.</p><h5 id=prediction-error-analysis>Prediction Error Analysis</h5><p>The following histogram shows the distribution of model prediction errors:</p><div class=echarts id=id-4 style=width:100%;height:30rem></div><p>The error distribution shows that approximately 73% of prediction errors fall within the ±5% range, demonstrating the model&rsquo;s good prediction accuracy.</p><h5 id=feature-importance-analysis>Feature Importance Analysis</h5><p>The heat map below shows the influence weights (regression coefficients) of different products on ingredient consumption predictions:</p><div class=echarts id=id-5 style=width:100%;height:30rem></div><p>The heat map clearly shows which products have the greatest impact on specific ingredient consumption. For example, Product 2 has a significant impact on Ingredient 0 (coefficient 1.95), while Product 3 has a significant impact on Ingredient 3 (coefficient 1.24).</p><h5 id=correlation-matrix-analysis>Correlation Matrix Analysis</h5><p>The following figure shows the correlation between the consumption of different ingredients:</p><div class=echarts id=id-6 style=width:100%;height:30rem></div><p>The correlation matrix reveals consumption pattern relationships between different ingredients, which is valuable for understanding product recipes and optimizing inventory management.</p><p>Through these visualizations, we can clearly see the effectiveness of the regression model in predicting ingredient consumption and how it continuously improves accuracy as data accumulates. These data-driven insights provide a solid technical foundation for the intelligent inventory management of the TeaInventory system.</p><h3 id=53-model-integration-and-adaptive-mechanisms>5.3 Model Integration and Adaptive Mechanisms</h3><p>The Tea system integrates the two models and implements adaptive optimization through the following mechanisms:</p><ol><li><p><strong>Data Collection</strong>: Collecting actual consumption data through inventory count differences and sales records</p></li><li><p><strong>Model Training Triggers</strong>:</p><ul><li>Early versions: New data automatically triggers training</li><li>Current version: Manual confirmation of training to ensure high-quality data</li></ul></li><li><p><strong>Adaptive Adjustment of Hybrid Coefficients</strong>:</p><ul><li>As model maturity increases, α value automatically decreases</li><li>Users can manually adjust to accommodate recipe changes</li></ul></li><li><p><strong>Prediction Evaluation</strong>:</p><ul><li>Using Mean Squared Error (MSE) to evaluate model performance</li><li>Normalized scoring by comparison with benchmark models</li></ul></li></ol><p>This integrated design combines classical inventory theory with machine learning methods to achieve efficient and accurate inventory prediction and management, particularly suitable for beverage shops with complex recipes and variable consumption patterns.</p><h2 id=6-technical-highlights>6. Technical Highlights</h2><h3 id=61-optimized-coredata-usage>6.1 Optimized CoreData Usage</h3><ul><li>Batch deletion operations (NSBatchDeleteRequest)</li><li>Well-designed relationship models</li><li>Cascading deletion implementation</li></ul><h3 id=62-advanced-swiftui-features>6.2 Advanced SwiftUI Features</h3><ul><li>Custom Alert and Sheet interactions</li><li>Complex form design</li><li>Dynamic lists and filtering</li><li>Multi-level navigation structure</li><li>Conditional rendering and state management</li></ul><h3 id=63-advanced-error-prevention-mechanisms>6.3 Advanced Error Prevention Mechanisms</h3><ul><li>Multi-layer confirmation dialogs</li><li>Text validation mechanisms</li><li>Clear UI feedback for states</li></ul><h3 id=64-data-analysis-and-visualization>6.4 Data Analysis and Visualization</h3><ul><li>Trend charts</li><li>Inventory status visualization</li><li>Intelligent restocking suggestions</li></ul><h3 id=65-google-sheets-integration>6.5 Google Sheets Integration</h3><ul><li>Cloud data synchronization via GoogleSheetsManager</li><li>Support for various operation logs</li></ul><h2 id=7-security-features>7. Security Features</h2><ul><li>Sensitive operations (such as deletion and reset) require multiple confirmations</li><li>Data validation and error handling</li><li>Operation logging</li></ul><h2 id=8-extensibility-design>8. Extensibility Design</h2><p>The system adopts a modular design for easy extension of new features:</p><ul><li>Reserved data import/export interfaces</li><li>Configurable prediction parameters</li><li>Customizable UI components</li><li>Loosely coupled business logic</li></ul><h2 id=9-future-development-directions>9. Future Development Directions</h2><ul><li>Further optimization of regression model algorithms</li><li>Addition of more data analysis features</li><li>Implementation of complete data import/export functionality</li><li>Support for multi-user collaboration and permission management</li><li>Enhanced integration with external systems (such as POS)</li></ul><p>The TeaInventory system significantly improves beverage shop inventory management efficiency through advanced prediction algorithms and intuitive user interfaces, reducing inventory waste and optimizing the restocking process, representing the latest level of inventory management technology in the industry.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2025-05-06&nbsp;<a class=git-hash href=https://github.com/dillonzq/LoveIt/commit/6878bba0251c2d46a7c24212606f609b2ee39751 target=_blank title="commit by max-7189(maxzhao0610@gmail.com) 6878bba0251c2d46a7c24212606f609b2ee39751: 修改tea-inventory-system页面中mermaid图表的渲染方式">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>6878bba</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/maxblog/tea-inventory-system/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on X" data-sharer=x data-url=https://max-7189.github.io/maxblog/tea-inventory-system/ data-title="TeaInventory - Beverage Shop Inventory Management System" data-hashtags="iOS,Swift,CoreData,Machine Learning,Inventory Management"><i class="fab fa-x-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Threads" data-sharer=threads data-url=https://max-7189.github.io/maxblog/tea-inventory-system/ data-title="TeaInventory - Beverage Shop Inventory Management System"><i class="fab fa-threads fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://max-7189.github.io/maxblog/tea-inventory-system/ data-hashtag=iOS><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://max-7189.github.io/maxblog/tea-inventory-system/ data-title="TeaInventory - Beverage Shop Inventory Management System"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://max-7189.github.io/maxblog/tea-inventory-system/ data-title="TeaInventory - Beverage Shop Inventory Management System"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@14.9.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://max-7189.github.io/maxblog/tea-inventory-system/ data-title="TeaInventory - Beverage Shop Inventory Management System"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Diaspora" data-sharer=diaspora data-url=https://max-7189.github.io/maxblog/tea-inventory-system/ data-title="TeaInventory - Beverage Shop Inventory Management System" data-description><i class="fab fa-diaspora fa-fw" aria-hidden=true></i></a><a href="https://t.me/share/url?url=https%3a%2f%2fmax-7189.github.io%2fmaxblog%2ftea-inventory-system%2f&amp;text=TeaInventory%20-%20Beverage%20Shop%20Inventory%20Management%20System" target=_blank title="Share on Telegram"><i class="fab fa-telegram fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/maxblog/tags/ios/>IOS</a>,&nbsp;<a href=/maxblog/tags/swift/>Swift</a>,&nbsp;<a href=/maxblog/tags/coredata/>CoreData</a>,&nbsp;<a href=/maxblog/tags/machine-learning/>Machine Learning</a>,&nbsp;<a href=/maxblog/tags/inventory-management/>Inventory Management</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/maxblog/>Home</a></span></section></div><div class=post-nav><a href=/maxblog/datamuse-project/ class=prev rel=prev title="DataMuse Project: A Multi-Agent AI System"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>DataMuse Project: A Multi-Agent AI System</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/maxblog/ target=_blank>Max Zhao</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i></a></div><div id=fixed-buttons-hidden><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css><script src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script src=https://cdn.jsdelivr.net/npm/algoliasearch@5.20.2/dist/lite/builds/browser.umd.min.js></script><script src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/copy-tex.min.js></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/mhchem.min.js></script><script>window.config={comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"4D1IDY8JU6",algoliaIndex:"index",algoliaSearchKey:"05332ac5ed76655a511f0da583a9afac",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"algolia"}}</script><script src=/maxblog/js/theme.min.js></script></body></html>